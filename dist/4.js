webpackJsonp([4],{113:function(t,e,l){l(177);var a=l(38)(l(128),l(171),"data-v-5f6ca155",null);t.exports=a.exports},128:function(t,e,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(t,e,l){isNaN(e)?l(new Error("请输入一个整数")):l()};e.default={data:function(){return{libraryId:localStorage.getItem("libraryId"),collcetionForm:{isbn:"",total_num:null,available_num:null},collectionData:[],total:void 0,pageSize:20,currentPage:1,currentTableType:"all",searchInput:"",collectionFormLoading:!1,collectionTableLoading:!1,dialogFormVisible:!1,collectionRules:{isbn:[{required:!0,message:"请输入isbn",trigger:"blur"}],total_num:[{required:!0,message:"请输入图书总数",trigger:"blur"},{validator:a}],available_num:[{required:!0,message:"请输入图书可借数目",trigger:"blur"},{validator:a}]}}},created:function(){this.fetchData(1)},methods:{submitForm:function(t){var e=this;e.$refs[t].validate(function(l){if(!l)return console.log("error submit!!"),!1;"collcetionForm"==t&&e.submitCollectionForm()})},submitCollectionForm:function(){var t=this,e=this;e.collectionFormLoading=!0,e.$axios.post("/api/libraries/"+this.libraryId+"/collections",e.collcetionForm).then(function(l){if(e.collectionFormLoading=!1,200==l.data.code){t.$createElement;t.$message.success("设置馆藏成功：《"+l.data.data.book_brief.title+"》 总数："+l.data.data.total_num+" 可借："+l.data.data.available_num),e.fetchData(e.currentPage),e.dialogFormVisible=!1,e.resetFields()}else e.$message.error("添加失败："+l.data.errmsg)}).catch(function(t){e.collectionFormLoading=!1,e.$message.error("服务器错误")})},resetFields:function(){this.collcetionForm={isbn:"",total_num:null,available_num:null}},handleEdit:function(t){this.collcetionForm.isbn=t.book_brief.isbn,this.collcetionForm.total_num=t.total_num,this.collcetionForm.available_num=t.available_num,this.dialogFormVisible=!0},handleSearch:function(){this.currentTableType="search",1==this.currentPage?this.fetchData(1):this.currentPage=1},resetTable:function(){this.searchInput="",this.currentTableType="all",1==this.currentPage?this.fetchData(1):this.currentPage=1},fetchData:function(t){var e=(t-1)*this.pageSize,l=this,a="/api/libraries/"+this.libraryId+"/collections?start="+e;"search"==this.currentTableType&&(a="/api/libraries/"+this.libraryId+"/collections?isbn="+l.searchInput),l.collectionTableLoading=!0,l.$axios.get(a).then(function(t){l.collectionTableLoading=!1,200==t.data.code?(l.collectionData=t.data.data.subjects,0==e&&(l.total=t.data.data.total)):l.$message.error("获取馆藏信息失败："+t.data.errmsg)}).catch(function(t){l.collectionTableLoading=!1,l.$message.error("服务器错误")})}}}},163:function(t,e,l){e=t.exports=l(10)(void 0),e.push([t.i,".el-pagination[data-v-5f6ca155]{margin-top:20px;text-align:center}",""])},171:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",{staticClass:"content"},[l("el-form",{attrs:{inline:!0}},[l("el-form-item",[l("el-input",{attrs:{placeholder:"图书ISBN"},model:{value:t.searchInput,callback:function(e){t.searchInput=e},expression:"searchInput"}})],1),t._v(" "),l("el-form-item",[l("el-button",{attrs:{type:"primary",disabled:!t.searchInput},on:{click:function(e){t.handleSearch()}}},[t._v("搜索馆藏")])],1),t._v(" "),l("el-form-item",[l("el-button",{on:{click:function(e){t.dialogFormVisible=!0}}},[t._v("添加馆藏")])],1),t._v(" "),l("el-form-item",[l("el-button",{on:{click:function(e){t.resetTable()}}},[t._v("重置")])],1)],1),t._v(" "),l("el-dialog",{attrs:{title:"设置馆藏",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e},close:t.resetFields}},[l("el-form",{ref:"collcetionForm",attrs:{rules:t.collectionRules,"label-width":"120px","label-position":"left",model:t.collcetionForm}},[l("el-form-item",{attrs:{label:"图书ISBN",prop:"isbn"}},[l("el-input",{model:{value:t.collcetionForm.isbn,callback:function(e){t.collcetionForm.isbn=e},expression:"collcetionForm.isbn"}})],1),t._v(" "),l("el-form-item",{attrs:{label:"图书总数",prop:"total_num"}},[l("el-input",{model:{value:t.collcetionForm.total_num,callback:function(e){t.collcetionForm.total_num=e},expression:"collcetionForm.total_num"}})],1),t._v(" "),l("el-form-item",{attrs:{label:"可借数目",prop:"available_num"}},[l("el-input",{model:{value:t.collcetionForm.available_num,callback:function(e){t.collcetionForm.available_num=e},expression:"collcetionForm.available_num"}})],1)],1),t._v(" "),l("div",{staticClass:"dialog-footer",slot:"footer"},[l("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),l("el-button",{attrs:{type:"primary",loading:t.collectionFormLoading},on:{click:function(e){t.submitForm("collcetionForm")}}},[t._v("确 定")])],1)],1),t._v(" "),l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.collectionTableLoading,expression:"collectionTableLoading"}],staticStyle:{width:"100%"},attrs:{data:t.collectionData,stripe:""}},[l("el-table-column",{attrs:{prop:"book_brief.title",label:"书名"}}),t._v(" "),l("el-table-column",{attrs:{prop:"book_brief.isbn",label:"ISBN"}}),t._v(" "),l("el-table-column",{attrs:{prop:"total_num",label:"图书总数",width:"150"}}),t._v(" "),l("el-table-column",{attrs:{prop:"available_num",label:"可借数目",width:"150"}}),t._v(" "),l("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-button",{attrs:{size:"small"},on:{click:function(l){t.handleEdit(e.row)}}},[t._v("编辑")])]}}])})],1),t._v(" "),l("el-pagination",{attrs:{layout:"prev, pager, next",total:t.total,"page-size":t.pageSize,"current-page":t.currentPage},on:{"update:currentPage":function(e){t.currentPage=e},"current-change":t.fetchData}}),t._v(" "),l("div",[t._v("一共"+t._s(t.total)+"条馆藏数据")])],1)},staticRenderFns:[]}},177:function(t,e,l){var a=l(163);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);l(39)("845a53ee",a,!0)}});
//# sourceMappingURL=4.js.map?fb294cebeb6c70b659d2