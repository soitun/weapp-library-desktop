{"version":3,"sources":["webpack:///4.js","webpack:///./src/components/Collection.vue","webpack:///Collection.vue","webpack:///./src/components/Collection.vue?3f12","webpack:///./src/components/Collection.vue?6e2f","webpack:///./src/components/Collection.vue?2d65"],"names":["webpackJsonp","113","module","exports","__webpack_require__","Component","128","__webpack_exports__","Object","defineProperty","value","validator","rule","callback","isNaN","Error","data","libraryId","localStorage","getItem","collcetionForm","isbn","total_num","available_num","collectionData","total","undefined","pageSize","currentPage","currentTableType","searchInput","collectionFormLoading","collectionTableLoading","dialogFormVisible","collectionRules","required","message","trigger","created","this","fetchData","methods","submitForm","formName","self","$refs","validate","valid","console","log","submitCollectionForm","_this","$axios","post","then","res","code","$createElement","$message","success","book_brief","title","resetFields","error","errmsg","catch","_","handleEdit","row","handleSearch","resetTable","p","start","url","get","subjects","163","push","i","171","render","_vm","_h","_c","_self","staticClass","attrs","inline","placeholder","model","$$v","expression","_v","type","disabled","on","click","$event","visible","update:visible","close","ref","rules","label-width","label-position","label","prop","slot","loading","directives","name","rawName","staticStyle","width","stripe","scopedSlots","_u","key","fn","scope","size","layout","page-size","current-page","update:currentPage","current-change","_s","staticRenderFns","177","content","locals"],"mappings":"AAAAA,cAAc,IAERC,IACA,SAAUC,EAAQC,EAASC,GCDjCA,EAAA,IAEA,IAAAC,GAAAD,EAAA,IAEAA,EAAA,KAEAA,EAAA,KAEA,kBAEA,KAGAF,GAAAC,QAAAE,EAAAF,SDUMG,IACA,SAAUJ,EAAQK,EAAqBH,GAE7C,YACAI,QAAOC,eAAeF,EAAqB,cAAgBG,OAAO,GEyBlE,IAAAC,GAAA,SAAAC,EAAAF,EAAAG,GF+BQC,MAAMJ,GACNG,EAAS,GAAIE,OE7BrB,YAEAF,IAGAN,GAAA,SF+BIS,KAAM,WACF,OACIC,UAAWC,aAAaC,QE5BpC,aF8BYC,gBACIC,KE7BhB,GF8BgBC,UE7BhB,KF8BgBC,cE3BhB,MF8BYC,kBACAC,UE7BZC,GF8BYC,SE7BZ,GF8BYC,YE7BZ,EF8BYC,iBAAkB,MAElBC,YE5BZ,GF8BYC,uBE7BZ,EF8BYC,wBE7BZ,EF8BYC,mBE3BZ,EF6BYC,iBACIb,OACIc,UE5BpB,EF6BoBC,QE5BpB,UF6BoBC,QE3BpB,SF6BgBf,YACIa,UE5BpB,EF6BoBC,QE5BpB,UF6BoBC,QE5BpB,SF8BoB1B,UE3BpBA,IF6BgBY,gBACIY,UE5BpB,EF6BoBC,QE5BpB,YF6BoBC,QE5BpB,SF8BoB1B,UEzBpBA,OF8BI2B,QAAS,WACLC,KAAKC,UE5Bb,IF8BIC,SACIC,WAAY,SAAoBC,GAC5B,GAAIC,GE5BhBL,IF6BYK,GAAKC,MAAMF,GAAUG,SAAS,SAAUC,GACpC,IAAIA,EAMA,MADAC,SAAQC,IE5B5B,mBACA,CFuBoC,mBAAZN,GACAC,EE5BxBM,0BFoCQA,qBAAsB,WE5B9B,GAAAC,GAAAZ,KF+BgBK,EE9BhBL,IF+BYK,GAAKb,uBE9BjB,EF+BYa,EAAKQ,OAAOC,KAAK,kBAAoBd,KAAKtB,UAAY,eAAgB2B,EAAKxB,gBAAgBkC,KAAK,SAAUC,GAEtG,GADAX,EAAKb,uBE9BrB,EF+BqC,KAAjBwB,EAAIvC,KAAKwC,KE9B7B,CF+B4BL,EE9B5BM,cF+BoBN,GAAMO,SAASC,QAAQ,WAAaJ,EAAIvC,KAAKA,KAAK4C,WAAWC,MAAQ,QAAUN,EAAIvC,KAAKA,KAAKM,UAAY,OAASiC,EAAIvC,KAAKA,KE9B/IO,eF+BoBqB,EAAKJ,UAAUI,EE9BnChB,aF+BoBgB,EAAKX,mBE9BzB,EF+BoBW,EE9BpBkB,kBFgCoBlB,GAAKc,SAASK,MAAM,QAAUR,EAAIvC,KE9BtDgD,UFgCeC,MAAM,SAAUC,GACftB,EAAKb,uBE9BrB,EF+BgBa,EAAKc,SAASK,ME9B9B,YFiCQD,YAAa,WACTvB,KAAKnB,gBACDC,KE9BhB,GF+BgBC,UE9BhB,KF+BgBC,cE7BhB,OFgCQ4C,WAAY,SAAoBC,GAC5B7B,KAAKnB,eAAeC,KAAO+C,EAAIR,WE9B3CvC,KF+BYkB,KAAKnB,eAAeE,UAAY8C,EE9B5C9C,UF+BYiB,KAAKnB,eAAeG,cAAgB6C,EE9BhD7C,cF+BYgB,KAAKN,mBE9BjB,GFgCQoC,aAAc,WACV9B,KAAKV,iBE9BjB,SACA,GF8BgBU,KAAKX,YE9BrBW,KAAAC,UACA,GAAAD,KAAAX,YACA,GF8BQ0C,WAAY,WACR/B,KAAKT,YE5BjB,GF6BYS,KAAKV,iBE3BjB,MAEA,GF4BgBU,KAAKX,YE5BrBW,KAAAC,UACA,GAAAD,KAAAX,YACA,GF4BQY,UAAW,SAAmB+B,GAC1B,GAAIC,IAASD,EAAI,GAAKhC,KE1BlCZ,SF2BgBiB,EE1BhBL,KF2BgBkC,EAAM,kBAAoBlC,KAAKtB,UAAY,sBE1B3DuD,CF2ByC,WAAzBjC,KAAKV,mBACL4C,EAAM,kBAAoBlC,KAAKtB,UAAY,qBAAuB2B,EE1BlFd,aF4BYc,EAAKZ,wBE1BjB,EF2BYY,EAAKQ,OAAOsB,IAAID,GAAKnB,KAAK,SAAUC,GAChCX,EAAKZ,wBE1BrB,EF2BqC,KAAjBuB,EAAIvC,KAAKwC,MACTZ,EAAKpB,eAAiB+B,EAAIvC,KAAKA,KEzBnD2D,SAEA,GF0BwBH,IE1BxB5B,EAAAnB,MAAA8B,EAAAvC,UACAS,QF2BoBmB,EAAKc,SAASK,MAAM,YAAcR,EAAIvC,KEzB1DgD,UF2BeC,MAAM,SAAUC,GACftB,EAAKZ,wBEzBrB,EF0BgBY,EAAKc,SAASK,MEzB9B,eFiCMa,IACA,SAAU1E,EAAQC,EAASC,GGrOjCD,EAAAD,EAAAC,QAAAC,EAAA,QAAAsB,IAKAvB,EAAA0E,MAAA3E,EAAA4E,EAAA,qEAA4F,MH8OtFC,IACA,SAAU7E,EAAQC,GIpPxBD,EAAAC,SAAgB6E,OAAA,WAAmB,GAAAC,GAAA1C,KAAa2C,EAAAD,EAAAxB,eAA0B0B,EAAAF,EAAAG,MAAAD,IAAAD,CAC1E,OAAAC,GAAA,OACAE,YAAA,YACGF,EAAA,WACHG,OACAC,QAAA,KAEGJ,EAAA,gBAAAA,EAAA,YACHG,OACAE,YAAA,UAEAC,OACA/E,MAAAuE,EAAA,YACApE,SAAA,SAAA6E,GACAT,EAAAnD,YAAA4D,GAEAC,WAAA,kBAEG,GAAAV,EAAAW,GAAA,KAAAT,EAAA,gBAAAA,EAAA,aACHG,OACAO,KAAA,UACAC,UAAAb,EAAAnD,aAEAiE,IACAC,MAAA,SAAAC,GACAhB,EAAAZ,mBAGGY,EAAAW,GAAA,cAAAX,EAAAW,GAAA,KAAAT,EAAA,gBAAAA,EAAA,aACHY,IACAC,MAAA,SAAAC,GACAhB,EAAAhD,mBAAA,MAGGgD,EAAAW,GAAA,cAAAX,EAAAW,GAAA,KAAAT,EAAA,gBAAAA,EAAA,aACHY,IACAC,MAAA,SAAAC,GACAhB,EAAAX,iBAGGW,EAAAW,GAAA,gBAAAX,EAAAW,GAAA,KAAAT,EAAA,aACHG,OACAzB,MAAA,OACAqC,QAAAjB,EAAAhD,mBAEA8D,IACAI,iBAAA,SAAAF,GACAhB,EAAAhD,kBAAAgE,GAEAG,MAAAnB,EAAAnB,eAEGqB,EAAA,WACHkB,IAAA,iBACAf,OACAgB,MAAArB,EAAA/C,gBACAqE,cAAA,QACAC,iBAAA,OACAf,MAAAR,EAAA7D,kBAEG+D,EAAA,gBACHG,OACAmB,MAAA,SACAC,KAAA,UAEGvB,EAAA,YACHM,OACA/E,MAAAuE,EAAA7D,eAAA,KACAP,SAAA,SAAA6E,GACAT,EAAA7D,eAAAC,KAAAqE,GAEAC,WAAA,0BAEG,GAAAV,EAAAW,GAAA,KAAAT,EAAA,gBACHG,OACAmB,MAAA,OACAC,KAAA,eAEGvB,EAAA,YACHM,OACA/E,MAAAuE,EAAA7D,eAAA,UACAP,SAAA,SAAA6E,GACAT,EAAA7D,eAAAE,UAAAoE,GAEAC,WAAA,+BAEG,GAAAV,EAAAW,GAAA,KAAAT,EAAA,gBACHG,OACAmB,MAAA,OACAC,KAAA,mBAEGvB,EAAA,YACHM,OACA/E,MAAAuE,EAAA7D,eAAA,cACAP,SAAA,SAAA6E,GACAT,EAAA7D,eAAAG,cAAAmE,GAEAC,WAAA,mCAEG,OAAAV,EAAAW,GAAA,KAAAT,EAAA,OACHE,YAAA,gBACAsB,KAAA,WACGxB,EAAA,aACHY,IACAC,MAAA,SAAAC,GACAhB,EAAAhD,mBAAA,MAGGgD,EAAAW,GAAA,SAAAX,EAAAW,GAAA,KAAAT,EAAA,aACHG,OACAO,KAAA,UACAe,QAAA3B,EAAAlD,uBAEAgE,IACAC,MAAA,SAAAC,GACAhB,EAAAvC,WAAA,sBAGGuC,EAAAW,GAAA,iBAAAX,EAAAW,GAAA,KAAAT,EAAA,YACH0B,aACAC,KAAA,UACAC,QAAA,YACArG,MAAAuE,EAAA,uBACAU,WAAA,2BAEAqB,aACAC,MAAA,QAEA3B,OACAtE,KAAAiE,EAAAzD,eACA0F,OAAA,MAEG/B,EAAA,mBACHG,OACAoB,KAAA,mBACAD,MAAA,QAEGxB,EAAAW,GAAA,KAAAT,EAAA,mBACHG,OACAoB,KAAA,kBACAD,MAAA,UAEGxB,EAAAW,GAAA,KAAAT,EAAA,mBACHG,OACAoB,KAAA,YACAD,MAAA,OACAQ,MAAA,SAEGhC,EAAAW,GAAA,KAAAT,EAAA,mBACHG,OACAoB,KAAA,gBACAD,MAAA,OACAQ,MAAA,SAEGhC,EAAAW,GAAA,KAAAT,EAAA,mBACHG,OACAmB,MAAA,KACAQ,MAAA,OAEAE,YAAAlC,EAAAmC,KACAC,IAAA,UACAC,GAAA,SAAAC,GACA,OAAApC,EAAA,aACAG,OACAkC,KAAA,SAEAzB,IACAC,MAAA,SAAAC,GACAhB,EAAAd,WAAAoD,EAAAnD,SAGSa,EAAAW,GAAA,gBAGN,GAAAX,EAAAW,GAAA,KAAAT,EAAA,iBACHG,OACAmC,OAAA,oBACAhG,MAAAwD,EAAAxD,MACAiG,YAAAzC,EAAAtD,SACAgG,eAAA1C,EAAArD,aAEAmE,IACA6B,qBAAA,SAAA3B,GACAhB,EAAArD,YAAAqE,GAEA4B,iBAAA5C,EAAAzC,aAEGyC,EAAAW,GAAA,KAAAT,EAAA,OAAAF,EAAAW,GAAA,KAAAX,EAAA6C,GAAA7C,EAAAxD,OAAA,gBACFsG,qBJ0PKC,IACA,SAAU9H,EAAQC,EAASC,GKnbjC,GAAA6H,GAAA7H,EAAA,IACA,iBAAA6H,SAAA/H,EAAA4E,EAAAmD,EAAA,MACAA,EAAAC,SAAAhI,EAAAC,QAAA8H,EAAAC,OAEA9H,GAAA,eAAA6H,GAAA","file":"4.js?fb294cebeb6c70b659d2","sourcesContent":["webpackJsonp([4],{\n\n/***/ 113:\n/***/ (function(module, exports, __webpack_require__) {\n\n\n/* styles */\n__webpack_require__(177)\n\nvar Component = __webpack_require__(38)(\n  /* script */\n  __webpack_require__(128),\n  /* template */\n  __webpack_require__(171),\n  /* scopeId */\n  \"data-v-5f6ca155\",\n  /* cssModules */\n  null\n)\n\nmodule.exports = Component.exports\n\n\n/***/ }),\n\n/***/ 128:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nvar validator = function validator(rule, value, callback) {\n    if (isNaN(value)) {\n        callback(new Error('请输入一个整数'));\n    } else {\n        callback();\n    }\n};\n\n/* harmony default export */ __webpack_exports__[\"default\"] = ({\n    data: function data() {\n        return {\n            libraryId: localStorage.getItem('libraryId'),\n\n            collcetionForm: {\n                isbn: \"\",\n                total_num: null,\n                available_num: null\n            },\n\n            collectionData: [],\n            total: undefined,\n            pageSize: 20,\n            currentPage: 1,\n            currentTableType: 'all', // all || search\n\n            searchInput: '',\n\n            collectionFormLoading: false,\n            collectionTableLoading: false,\n            dialogFormVisible: false,\n\n            collectionRules: {\n                isbn: [{\n                    required: true,\n                    message: '请输入isbn',\n                    trigger: 'blur'\n                }],\n                total_num: [{\n                    required: true,\n                    message: '请输入图书总数',\n                    trigger: 'blur'\n                }, {\n                    validator: validator\n                }],\n                available_num: [{\n                    required: true,\n                    message: '请输入图书可借数目',\n                    trigger: 'blur'\n                }, {\n                    validator: validator\n                }]\n            }\n        };\n    },\n    created: function created() {\n        this.fetchData(1);\n    },\n    methods: {\n        submitForm: function submitForm(formName) {\n            var self = this;\n            self.$refs[formName].validate(function (valid) {\n                if (valid) {\n                    if (formName == 'collcetionForm') {\n                        self.submitCollectionForm();\n                    }\n                } else {\n                    console.log('error submit!!');\n                    return false;\n                }\n            });\n        },\n        submitCollectionForm: function submitCollectionForm() {\n            var _this = this;\n\n            var self = this;\n            self.collectionFormLoading = true;\n            self.$axios.post('/api/libraries/' + this.libraryId + '/collections', self.collcetionForm).then(function (res) {\n                self.collectionFormLoading = false;\n                if (res.data.code == 200) {\n                    var h = _this.$createElement;\n                    _this.$message.success(\"设置馆藏成功：《\" + res.data.data.book_brief.title + \"》 总数：\" + res.data.data.total_num + \" 可借：\" + res.data.data.available_num);\n                    self.fetchData(self.currentPage);\n                    self.dialogFormVisible = false;\n                    self.resetFields();\n                } else {\n                    self.$message.error(\"添加失败：\" + res.data.errmsg);\n                }\n            }).catch(function (_) {\n                self.collectionFormLoading = false;\n                self.$message.error(\"服务器错误\");\n            });\n        },\n        resetFields: function resetFields() {\n            this.collcetionForm = {\n                isbn: \"\",\n                total_num: null,\n                available_num: null\n            };\n        },\n        handleEdit: function handleEdit(row) {\n            this.collcetionForm.isbn = row.book_brief.isbn;\n            this.collcetionForm.total_num = row.total_num;\n            this.collcetionForm.available_num = row.available_num;\n            this.dialogFormVisible = true;\n        },\n        handleSearch: function handleSearch() {\n            this.currentTableType = 'search';\n            if (this.currentPage == 1) this.fetchData(1);else this.currentPage = 1;\n        },\n        resetTable: function resetTable() {\n            this.searchInput = '';\n            this.currentTableType = 'all';\n\n            //currentPage为1时，设置total不会改变currentPage\n            if (this.currentPage == 1) this.fetchData(1);else this.currentPage = 1;\n        },\n        fetchData: function fetchData(p) {\n            var start = (p - 1) * this.pageSize;\n            var self = this;\n            var url = '/api/libraries/' + this.libraryId + '/collections?start=' + start;\n            if (this.currentTableType == 'search') {\n                url = '/api/libraries/' + this.libraryId + '/collections?isbn=' + self.searchInput;\n            }\n            self.collectionTableLoading = true;\n            self.$axios.get(url).then(function (res) {\n                self.collectionTableLoading = false;\n                if (res.data.code == 200) {\n                    self.collectionData = res.data.data.subjects;\n\n                    // total改变时，currentPage也会改变，会触发current-change事件\n                    if (start == 0) self.total = res.data.data.total;\n                } else {\n                    self.$message.error(\"获取馆藏信息失败：\" + res.data.errmsg);\n                }\n            }).catch(function (_) {\n                self.collectionTableLoading = false;\n                self.$message.error(\"服务器错误\");\n            });\n        }\n    }\n});\n\n/***/ }),\n\n/***/ 163:\n/***/ (function(module, exports, __webpack_require__) {\n\nexports = module.exports = __webpack_require__(10)(undefined);\n// imports\n\n\n// module\nexports.push([module.i, \".el-pagination[data-v-5f6ca155]{margin-top:20px;text-align:center}\", \"\"]);\n\n// exports\n\n\n/***/ }),\n\n/***/ 171:\n/***/ (function(module, exports) {\n\nmodule.exports={render:function (){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;\n  return _c('div', {\n    staticClass: \"content\"\n  }, [_c('el-form', {\n    attrs: {\n      \"inline\": true\n    }\n  }, [_c('el-form-item', [_c('el-input', {\n    attrs: {\n      \"placeholder\": \"图书ISBN\"\n    },\n    model: {\n      value: (_vm.searchInput),\n      callback: function($$v) {\n        _vm.searchInput = $$v\n      },\n      expression: \"searchInput\"\n    }\n  })], 1), _vm._v(\" \"), _c('el-form-item', [_c('el-button', {\n    attrs: {\n      \"type\": \"primary\",\n      \"disabled\": !_vm.searchInput\n    },\n    on: {\n      \"click\": function($event) {\n        _vm.handleSearch()\n      }\n    }\n  }, [_vm._v(\"搜索馆藏\")])], 1), _vm._v(\" \"), _c('el-form-item', [_c('el-button', {\n    on: {\n      \"click\": function($event) {\n        _vm.dialogFormVisible = true\n      }\n    }\n  }, [_vm._v(\"添加馆藏\")])], 1), _vm._v(\" \"), _c('el-form-item', [_c('el-button', {\n    on: {\n      \"click\": function($event) {\n        _vm.resetTable()\n      }\n    }\n  }, [_vm._v(\"重置\")])], 1)], 1), _vm._v(\" \"), _c('el-dialog', {\n    attrs: {\n      \"title\": \"设置馆藏\",\n      \"visible\": _vm.dialogFormVisible\n    },\n    on: {\n      \"update:visible\": function($event) {\n        _vm.dialogFormVisible = $event\n      },\n      \"close\": _vm.resetFields\n    }\n  }, [_c('el-form', {\n    ref: \"collcetionForm\",\n    attrs: {\n      \"rules\": _vm.collectionRules,\n      \"label-width\": \"120px\",\n      \"label-position\": \"left\",\n      \"model\": _vm.collcetionForm\n    }\n  }, [_c('el-form-item', {\n    attrs: {\n      \"label\": \"图书ISBN\",\n      \"prop\": \"isbn\"\n    }\n  }, [_c('el-input', {\n    model: {\n      value: (_vm.collcetionForm.isbn),\n      callback: function($$v) {\n        _vm.collcetionForm.isbn = $$v\n      },\n      expression: \"collcetionForm.isbn\"\n    }\n  })], 1), _vm._v(\" \"), _c('el-form-item', {\n    attrs: {\n      \"label\": \"图书总数\",\n      \"prop\": \"total_num\"\n    }\n  }, [_c('el-input', {\n    model: {\n      value: (_vm.collcetionForm.total_num),\n      callback: function($$v) {\n        _vm.collcetionForm.total_num = $$v\n      },\n      expression: \"collcetionForm.total_num\"\n    }\n  })], 1), _vm._v(\" \"), _c('el-form-item', {\n    attrs: {\n      \"label\": \"可借数目\",\n      \"prop\": \"available_num\"\n    }\n  }, [_c('el-input', {\n    model: {\n      value: (_vm.collcetionForm.available_num),\n      callback: function($$v) {\n        _vm.collcetionForm.available_num = $$v\n      },\n      expression: \"collcetionForm.available_num\"\n    }\n  })], 1)], 1), _vm._v(\" \"), _c('div', {\n    staticClass: \"dialog-footer\",\n    slot: \"footer\"\n  }, [_c('el-button', {\n    on: {\n      \"click\": function($event) {\n        _vm.dialogFormVisible = false\n      }\n    }\n  }, [_vm._v(\"取 消\")]), _vm._v(\" \"), _c('el-button', {\n    attrs: {\n      \"type\": \"primary\",\n      \"loading\": _vm.collectionFormLoading\n    },\n    on: {\n      \"click\": function($event) {\n        _vm.submitForm('collcetionForm')\n      }\n    }\n  }, [_vm._v(\"确 定\")])], 1)], 1), _vm._v(\" \"), _c('el-table', {\n    directives: [{\n      name: \"loading\",\n      rawName: \"v-loading\",\n      value: (_vm.collectionTableLoading),\n      expression: \"collectionTableLoading\"\n    }],\n    staticStyle: {\n      \"width\": \"100%\"\n    },\n    attrs: {\n      \"data\": _vm.collectionData,\n      \"stripe\": \"\"\n    }\n  }, [_c('el-table-column', {\n    attrs: {\n      \"prop\": \"book_brief.title\",\n      \"label\": \"书名\"\n    }\n  }), _vm._v(\" \"), _c('el-table-column', {\n    attrs: {\n      \"prop\": \"book_brief.isbn\",\n      \"label\": \"ISBN\"\n    }\n  }), _vm._v(\" \"), _c('el-table-column', {\n    attrs: {\n      \"prop\": \"total_num\",\n      \"label\": \"图书总数\",\n      \"width\": \"150\"\n    }\n  }), _vm._v(\" \"), _c('el-table-column', {\n    attrs: {\n      \"prop\": \"available_num\",\n      \"label\": \"可借数目\",\n      \"width\": \"150\"\n    }\n  }), _vm._v(\" \"), _c('el-table-column', {\n    attrs: {\n      \"label\": \"操作\",\n      \"width\": \"150\"\n    },\n    scopedSlots: _vm._u([{\n      key: \"default\",\n      fn: function(scope) {\n        return [_c('el-button', {\n          attrs: {\n            \"size\": \"small\"\n          },\n          on: {\n            \"click\": function($event) {\n              _vm.handleEdit(scope.row)\n            }\n          }\n        }, [_vm._v(\"编辑\")])]\n      }\n    }])\n  })], 1), _vm._v(\" \"), _c('el-pagination', {\n    attrs: {\n      \"layout\": \"prev, pager, next\",\n      \"total\": _vm.total,\n      \"page-size\": _vm.pageSize,\n      \"current-page\": _vm.currentPage\n    },\n    on: {\n      \"update:currentPage\": function($event) {\n        _vm.currentPage = $event\n      },\n      \"current-change\": _vm.fetchData\n    }\n  }), _vm._v(\" \"), _c('div', [_vm._v(\"一共\" + _vm._s(_vm.total) + \"条馆藏数据\")])], 1)\n},staticRenderFns: []}\n\n/***/ }),\n\n/***/ 177:\n/***/ (function(module, exports, __webpack_require__) {\n\n// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = __webpack_require__(163);\nif(typeof content === 'string') content = [[module.i, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar update = __webpack_require__(39)(\"845a53ee\", content, true);\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// 4.js?fb294cebeb6c70b659d2","\n/* styles */\nrequire(\"!!vue-style-loader!css-loader?minimize!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"id\\\":\\\"data-v-5f6ca155\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Collection.vue\")\n\nvar Component = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")(\n  /* script */\n  require(\"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./Collection.vue\"),\n  /* template */\n  require(\"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-5f6ca155\\\"}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./Collection.vue\"),\n  /* scopeId */\n  \"data-v-5f6ca155\",\n  /* cssModules */\n  null\n)\n\nmodule.exports = Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Collection.vue\n// module id = 113\n// module chunks = 4","<template>\n    <div class=\"content\">\n        <el-form :inline=\"true\">\n            <el-form-item>\n                <el-input v-model=\"searchInput\" placeholder=\"图书ISBN\"></el-input>\n            </el-form-item>\n            <el-form-item>\n                <el-button type=\"primary\" :disabled=\"!searchInput\" @click=\"handleSearch()\">搜索馆藏</el-button>\n            </el-form-item>\n            <el-form-item>\n                <el-button @click=\"dialogFormVisible=true\">添加馆藏</el-button>\n            </el-form-item>\n            <el-form-item>\n                <el-button @click=\"resetTable()\">重置</el-button>\n            </el-form-item>\n        </el-form>\n        <el-dialog title=\"设置馆藏\" :visible.sync=\"dialogFormVisible\" v-on:close=\"resetFields\">\n            <el-form :rules=\"collectionRules\" label-width=\"120px\" label-position=\"left\" :model=\"collcetionForm\" ref=\"collcetionForm\">\n                <el-form-item label=\"图书ISBN\" prop=\"isbn\">\n                    <el-input v-model=\"collcetionForm.isbn\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"图书总数\" prop=\"total_num\">\n                    <el-input v-model=\"collcetionForm.total_num\"></el-input>\n                </el-form-item>\n                <el-form-item label=\"可借数目\" prop=\"available_num\">\n                    <el-input v-model=\"collcetionForm.available_num\"></el-input>\n                </el-form-item>\n            </el-form>\n            <div slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click=\"dialogFormVisible = false\">取 消</el-button>\n                <el-button type=\"primary\" :loading=\"collectionFormLoading\" @click=\"submitForm('collcetionForm')\">确 定</el-button>\n            </div>\n        </el-dialog>\n        <el-table v-loading=\"collectionTableLoading\" :data=\"collectionData\" stripe style=\"width: 100%\">\n            <el-table-column prop=\"book_brief.title\" label=\"书名\">\n            </el-table-column>\n            <el-table-column prop=\"book_brief.isbn\" label=\"ISBN\">\n            </el-table-column>\n            <el-table-column prop=\"total_num\" label=\"图书总数\" width=\"150\">\n            </el-table-column>\n            <el-table-column prop=\"available_num\" label=\"可借数目\" width=\"150\">\n            </el-table-column>\n            <el-table-column label=\"操作\" width=\"150\">\n                <template scope=\"scope\">\n                    <el-button size=\"small\" @click=\"handleEdit(scope.row)\">编辑</el-button>\n                </template>\n            </el-table-column>\n        </el-table>\n        <el-pagination layout=\"prev, pager, next\" :total=\"total\" :page-size=\"pageSize\" :current-page.sync=\"currentPage\" @current-change=\"fetchData\">\n        </el-pagination>\n        <div>一共{{total}}条馆藏数据</div>\n    </div>\n</template>\n<script>\nvar validator = (rule, value, callback) => {\n    if (isNaN(value)) {\n        callback(new Error('请输入一个整数'));\n    } else {\n        callback();\n    }\n}\n\nexport default {\n    data: () => {\n        return {\n            libraryId: localStorage.getItem('libraryId'),\n\n            collcetionForm: {\n                isbn: \"\",\n                total_num: null,\n                available_num: null\n            },\n\n            collectionData: [],\n            total: undefined,\n            pageSize: 20,\n            currentPage: 1,\n            currentTableType: 'all', // all || search\n\n            searchInput: '',\n\n            collectionFormLoading: false,\n            collectionTableLoading: false,\n            dialogFormVisible: false,\n\n\n            collectionRules: {\n                isbn: [{\n                    required: true,\n                    message: '请输入isbn',\n                    trigger: 'blur'\n                }],\n                total_num: [{\n                    required: true,\n                    message: '请输入图书总数',\n                    trigger: 'blur'\n                }, {\n                    validator: validator\n                }],\n                available_num: [{\n                    required: true,\n                    message: '请输入图书可借数目',\n                    trigger: 'blur'\n                }, {\n                    validator: validator\n                }]\n            }\n        }\n    },\n    created: function() {\n        this.fetchData(1);\n    },\n    methods: {\n        submitForm(formName) {\n            const self = this;\n            self.$refs[formName].validate((valid) => {\n                if (valid) {\n                    if (formName == 'collcetionForm') {\n                        self.submitCollectionForm();\n                    }\n                } else {\n                    console.log('error submit!!');\n                    return false;\n                }\n            });\n        },\n        submitCollectionForm() {\n            const self = this;\n            self.collectionFormLoading = true;\n            self.$axios.post('/api/libraries/' + this.libraryId + '/collections', self.collcetionForm).then(res => {\n                self.collectionFormLoading = false;\n                if (res.data.code == 200) {\n                    const h = this.$createElement;\n                    this.$message.success(\"设置馆藏成功：《\" + res.data.data.book_brief.title + \"》 总数：\" + res.data.data.total_num + \" 可借：\" + res.data.data.available_num)\n                    self.fetchData(self.currentPage);\n                    self.dialogFormVisible = false;\n                    self.resetFields();\n                } else {\n                    self.$message.error(\"添加失败：\" + res.data.errmsg);\n                }\n            }).catch(_ => {\n                self.collectionFormLoading = false;\n                self.$message.error(\"服务器错误\")\n            })\n        },\n        resetFields() {\n            this.collcetionForm = {\n                isbn: \"\",\n                total_num: null,\n                available_num: null\n            }\n        },\n        handleEdit(row) {\n            this.collcetionForm.isbn = row.book_brief.isbn;\n            this.collcetionForm.total_num = row.total_num;\n            this.collcetionForm.available_num = row.available_num;\n            this.dialogFormVisible = true\n        },\n        handleSearch() {\n            this.currentTableType = 'search';\n            if (this.currentPage == 1)\n                this.fetchData(1);\n            else this.currentPage = 1;\n        },\n        resetTable() {\n            this.searchInput = '';\n            this.currentTableType = 'all';\n\n            //currentPage为1时，设置total不会改变currentPage\n            if (this.currentPage == 1)\n                this.fetchData(1);\n            else this.currentPage = 1;\n        },\n        fetchData(p) {\n            var start = (p - 1) * this.pageSize;\n            var self = this;\n            var url = '/api/libraries/' + this.libraryId + '/collections?start=' + start;\n            if (this.currentTableType == 'search') {\n                url = '/api/libraries/' + this.libraryId + '/collections?isbn=' + self.searchInput;\n            }\n            self.collectionTableLoading = true;\n            self.$axios.get(url).then(res => {\n                self.collectionTableLoading = false;\n                if (res.data.code == 200) {\n                    self.collectionData = res.data.data.subjects;\n\n                    // total改变时，currentPage也会改变，会触发current-change事件\n                    if (start == 0)\n                        self.total = res.data.data.total;\n                } else {\n                    self.$message.error(\"获取馆藏信息失败：\" + res.data.errmsg);\n                }\n            }).catch(_ => {\n                self.collectionTableLoading = false;\n                self.$message.error(\"服务器错误\")\n            })\n        }\n    }\n}\n</script>\n<style scoped>\n.el-pagination {\n    margin-top: 20px;\n    text-align: center;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// Collection.vue?03f3eab8","exports = module.exports = require(\"../../node_modules/css-loader/lib/css-base.js\")(undefined);\n// imports\n\n\n// module\nexports.push([module.id, \".el-pagination[data-v-5f6ca155]{margin-top:20px;text-align:center}\", \"\"]);\n\n// exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/css-loader?minimize!./~/vue-loader/lib/style-compiler?{\"id\":\"data-v-5f6ca155\",\"scoped\":true,\"hasInlineConfig\":false}!./~/vue-loader/lib/selector.js?type=styles&index=0!./src/components/Collection.vue\n// module id = 163\n// module chunks = 4","module.exports={render:function (){var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;\n  return _c('div', {\n    staticClass: \"content\"\n  }, [_c('el-form', {\n    attrs: {\n      \"inline\": true\n    }\n  }, [_c('el-form-item', [_c('el-input', {\n    attrs: {\n      \"placeholder\": \"图书ISBN\"\n    },\n    model: {\n      value: (_vm.searchInput),\n      callback: function($$v) {\n        _vm.searchInput = $$v\n      },\n      expression: \"searchInput\"\n    }\n  })], 1), _vm._v(\" \"), _c('el-form-item', [_c('el-button', {\n    attrs: {\n      \"type\": \"primary\",\n      \"disabled\": !_vm.searchInput\n    },\n    on: {\n      \"click\": function($event) {\n        _vm.handleSearch()\n      }\n    }\n  }, [_vm._v(\"搜索馆藏\")])], 1), _vm._v(\" \"), _c('el-form-item', [_c('el-button', {\n    on: {\n      \"click\": function($event) {\n        _vm.dialogFormVisible = true\n      }\n    }\n  }, [_vm._v(\"添加馆藏\")])], 1), _vm._v(\" \"), _c('el-form-item', [_c('el-button', {\n    on: {\n      \"click\": function($event) {\n        _vm.resetTable()\n      }\n    }\n  }, [_vm._v(\"重置\")])], 1)], 1), _vm._v(\" \"), _c('el-dialog', {\n    attrs: {\n      \"title\": \"设置馆藏\",\n      \"visible\": _vm.dialogFormVisible\n    },\n    on: {\n      \"update:visible\": function($event) {\n        _vm.dialogFormVisible = $event\n      },\n      \"close\": _vm.resetFields\n    }\n  }, [_c('el-form', {\n    ref: \"collcetionForm\",\n    attrs: {\n      \"rules\": _vm.collectionRules,\n      \"label-width\": \"120px\",\n      \"label-position\": \"left\",\n      \"model\": _vm.collcetionForm\n    }\n  }, [_c('el-form-item', {\n    attrs: {\n      \"label\": \"图书ISBN\",\n      \"prop\": \"isbn\"\n    }\n  }, [_c('el-input', {\n    model: {\n      value: (_vm.collcetionForm.isbn),\n      callback: function($$v) {\n        _vm.collcetionForm.isbn = $$v\n      },\n      expression: \"collcetionForm.isbn\"\n    }\n  })], 1), _vm._v(\" \"), _c('el-form-item', {\n    attrs: {\n      \"label\": \"图书总数\",\n      \"prop\": \"total_num\"\n    }\n  }, [_c('el-input', {\n    model: {\n      value: (_vm.collcetionForm.total_num),\n      callback: function($$v) {\n        _vm.collcetionForm.total_num = $$v\n      },\n      expression: \"collcetionForm.total_num\"\n    }\n  })], 1), _vm._v(\" \"), _c('el-form-item', {\n    attrs: {\n      \"label\": \"可借数目\",\n      \"prop\": \"available_num\"\n    }\n  }, [_c('el-input', {\n    model: {\n      value: (_vm.collcetionForm.available_num),\n      callback: function($$v) {\n        _vm.collcetionForm.available_num = $$v\n      },\n      expression: \"collcetionForm.available_num\"\n    }\n  })], 1)], 1), _vm._v(\" \"), _c('div', {\n    staticClass: \"dialog-footer\",\n    slot: \"footer\"\n  }, [_c('el-button', {\n    on: {\n      \"click\": function($event) {\n        _vm.dialogFormVisible = false\n      }\n    }\n  }, [_vm._v(\"取 消\")]), _vm._v(\" \"), _c('el-button', {\n    attrs: {\n      \"type\": \"primary\",\n      \"loading\": _vm.collectionFormLoading\n    },\n    on: {\n      \"click\": function($event) {\n        _vm.submitForm('collcetionForm')\n      }\n    }\n  }, [_vm._v(\"确 定\")])], 1)], 1), _vm._v(\" \"), _c('el-table', {\n    directives: [{\n      name: \"loading\",\n      rawName: \"v-loading\",\n      value: (_vm.collectionTableLoading),\n      expression: \"collectionTableLoading\"\n    }],\n    staticStyle: {\n      \"width\": \"100%\"\n    },\n    attrs: {\n      \"data\": _vm.collectionData,\n      \"stripe\": \"\"\n    }\n  }, [_c('el-table-column', {\n    attrs: {\n      \"prop\": \"book_brief.title\",\n      \"label\": \"书名\"\n    }\n  }), _vm._v(\" \"), _c('el-table-column', {\n    attrs: {\n      \"prop\": \"book_brief.isbn\",\n      \"label\": \"ISBN\"\n    }\n  }), _vm._v(\" \"), _c('el-table-column', {\n    attrs: {\n      \"prop\": \"total_num\",\n      \"label\": \"图书总数\",\n      \"width\": \"150\"\n    }\n  }), _vm._v(\" \"), _c('el-table-column', {\n    attrs: {\n      \"prop\": \"available_num\",\n      \"label\": \"可借数目\",\n      \"width\": \"150\"\n    }\n  }), _vm._v(\" \"), _c('el-table-column', {\n    attrs: {\n      \"label\": \"操作\",\n      \"width\": \"150\"\n    },\n    scopedSlots: _vm._u([{\n      key: \"default\",\n      fn: function(scope) {\n        return [_c('el-button', {\n          attrs: {\n            \"size\": \"small\"\n          },\n          on: {\n            \"click\": function($event) {\n              _vm.handleEdit(scope.row)\n            }\n          }\n        }, [_vm._v(\"编辑\")])]\n      }\n    }])\n  })], 1), _vm._v(\" \"), _c('el-pagination', {\n    attrs: {\n      \"layout\": \"prev, pager, next\",\n      \"total\": _vm.total,\n      \"page-size\": _vm.pageSize,\n      \"current-page\": _vm.currentPage\n    },\n    on: {\n      \"update:currentPage\": function($event) {\n        _vm.currentPage = $event\n      },\n      \"current-change\": _vm.fetchData\n    }\n  }), _vm._v(\" \"), _c('div', [_vm._v(\"一共\" + _vm._s(_vm.total) + \"条馆藏数据\")])], 1)\n},staticRenderFns: []}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/vue-loader/lib/template-compiler?{\"id\":\"data-v-5f6ca155\"}!./~/vue-loader/lib/selector.js?type=template&index=0!./src/components/Collection.vue\n// module id = 171\n// module chunks = 4","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../node_modules/css-loader/index.js?minimize!../../node_modules/vue-loader/lib/style-compiler/index.js?{\\\"id\\\":\\\"data-v-5f6ca155\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector.js?type=styles&index=0!./Collection.vue\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar update = require(\"!../../node_modules/vue-style-loader/lib/addStylesClient.js\")(\"845a53ee\", content, true);\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/vue-style-loader!./~/css-loader?minimize!./~/vue-loader/lib/style-compiler?{\"id\":\"data-v-5f6ca155\",\"scoped\":true,\"hasInlineConfig\":false}!./~/vue-loader/lib/selector.js?type=styles&index=0!./src/components/Collection.vue\n// module id = 177\n// module chunks = 4"],"sourceRoot":""}